/*! x509-1.1.13.js (c) 2012-2017 Kenji Urushima | kjur.github.com/jsrsasign/license
 */
function X509(){var b=ASN1HEX;var a=X509;this.subjectPublicKeyRSA=null;this.subjectPublicKeyRSA_hN=null;this.subjectPublicKeyRSA_hE=null;this.hex=null;this.version=0;this.foffset=0;this.getVersion=function(){if(this.hex===null||this.version!==0){return this.version}if(b.getTLVbyList(this.hex,0,[0,0])!=="a003020102"){this.version=1;this.foffset=-1;return 1}this.version=3;return 3};this.getSerialNumberHex=function(){return b.getVbyList(this.hex,0,[0,1+this.foffset],"02")};this.getSignatureAlgorithmField=function(){var d=b.getVbyList(this.hex,0,[0,2+this.foffset,0],"06");var c=KJUR.asn1.ASN1Util.oidHexToInt(d);var e=KJUR.asn1.x509.OID.oid2name(c);return e};this.getIssuerHex=function(){return b.getTLVbyList(this.hex,0,[0,3+this.foffset],"30")};this.getIssuerString=function(){return a.hex2dn(this.getIssuerHex())};this.getSubjectHex=function(){return b.getTLVbyList(this.hex,0,[0,5+this.foffset],"30")};this.getSubjectString=function(){return a.hex2dn(this.getSubjectHex())};this.getNotBefore=function(){var c=b.getVbyList(this.hex,0,[0,4+this.foffset,0]);c=c.replace(/(..)/g,"%$1");c=decodeURIComponent(c);return c};this.getNotAfter=function(){var c=b.getVbyList(this.hex,0,[0,4+this.foffset,1]);c=c.replace(/(..)/g,"%$1");c=decodeURIComponent(c);return c};this.getPublicKeyHex=function(){return b.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyIdx=function(){return b.getIdxbyList(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKey=function(){return KEYUTIL.getKey(this.getPublicKeyHex(),null,"pkcs8pub")};this.readCertPEM=function(c){this.readCertHex(b.pemToHex(c))};this.readCertHex=function(c){this.hex=c;this.getVersion();pubkey=this.getPublicKey();if(pubkey instanceof RSAKey){this.subjectPublicKeyRSA=pubkey;this.subjectPublicKeyRSA_hN=hextoposhex(pubkey.n.toString(16));this.subjectPublicKeyRSA_hE=hextoposhex(pubkey.e.toString(16))}};this.readCertPEMWithoutRSAInit=function(d){var e=b.pemToHex(d);var c=a.getPublicKeyHexArrayFromCertHex(e);if(typeof this.subjectPublicKeyRSA.setPublic==="function"){this.subjectPublicKeyRSA.setPublic(c[0],c[1])}this.subjectPublicKeyRSA_hN=c[0];this.subjectPublicKeyRSA_hE=c[1];this.hex=e};this.getInfo=function(){var d=X509;var q,j,o;q="Basic Fields\n";q+="  serial number: "+this.getSerialNumberHex()+"\n";q+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n";q+="  issuer: "+this.getIssuerString()+"\n";q+="  notBefore: "+this.getNotBefore()+"\n";q+="  notAfter: "+this.getNotAfter()+"\n";q+="  subject: "+this.getSubjectString()+"\n";q+="  subject public key info: \n";j=this.getPublicKey();q+="    key algorithm: "+j.type+"\n";if(j.type==="RSA"){q+="    n="+hextoposhex(j.n.toString(16)).substr(0,16)+"...\n";q+="    e="+hextoposhex(j.e.toString(16))+"\n"}q+="X509v3 Extensions:\n";o=d.getV3ExtInfoListOfCertHex(this.hex);for(var g=0;g<o.length;g++){var e=o[g];var p=KJUR.asn1.x509.OID.oid2name(e.oid);if(p===""){p=e.oid}var m="";if(e.critical===true){m="CRITICAL"}q+="  "+p+" "+m+":\n";if(p==="basicConstraints"){var k=d.getExtBasicConstraints(this.hex);if(k.cA===undefined){q+="    {}\n"}else{q+="    cA=true";if(k.pathLen!==undefined){q+=", pathLen="+k.pathLen}q+="\n"}}else{if(p==="keyUsage"){q+="    "+d.getExtKeyUsageString(this.hex)+"\n"}else{if(p==="subjectKeyIdentifier"){q+="    "+d.getExtSubjectKeyIdentifier(this.hex)+"\n"}else{if(p==="authorityKeyIdentifier"){var c=d.getExtAuthorityKeyIdentifier(this.hex);if(c.kid!==undefined){q+="    kid="+c.kid+"\n"}}else{if(p==="extKeyUsage"){var l=d.getExtExtKeyUsageName(this.hex);q+="    "+l.join(", ")+"\n"}else{if(p==="subjectAltName"){var h=d.getExtSubjectAltName(this.hex);q+="    "+h.join(", ")+"\n"}else{if(p==="cRLDistributionPoints"){var n=d.getExtCRLDistributionPointsURI(this.hex);q+="    "+n+"\n"}else{if(p==="authorityInfoAccess"){var f=d.getExtAIAInfo(this.hex);if(f.ocsp!==undefined){q+="    ocsp: "+f.ocsp.join(",")+"\n"}if(f.caissuer!==undefined){q+="    caissuer: "+f.caissuer.join(",")+"\n"}}}}}}}}}}q+="signature algorithm: "+d.getSignatureAlgorithmName(this.hex)+"\n";q+="signature: "+d.getSignatureValueHex(this.hex).substr(0,16)+"...\n";return q}}X509.pemToBase64=function(a){var b=a;b=b.replace("-----BEGIN CERTIFICATE-----","");b=b.replace("-----END CERTIFICATE-----","");b=b.replace(/[ \n]+/g,"");return b};X509.pemToHex=function(a){return ASN1HEX.pemToHex(a)};X509.getSubjectPublicKeyPosFromCertHex=function(f){var e=X509.getSubjectPublicKeyInfoPosFromCertHex(f);if(e==-1){return -1}var b=ASN1HEX.getPosArrayOfChildren_AtObj(f,e);if(b.length!=2){return -1}var d=b[1];if(f.substring(d,d+2)!="03"){return -1}var c=ASN1HEX.getStartPosOfV_AtObj(f,d);if(f.substring(c,c+2)!="00"){return -1}return c+2};X509.getSubjectPublicKeyInfoPosFromCertHex=function(b){var a=new X509();a.readCertHex(b);return a.getPublicKeyIdx()};X509.getPublicKeyHexArrayFromCertHex=function(g){var d=ASN1HEX;var f,b,e,c;f=X509.getSubjectPublicKeyPosFromCertHex(g);b=d.getPosArrayOfChildren_AtObj(g,f);if(b.length!=2){return[]}e=d.getHexOfV_AtObj(g,b[0]);c=d.getHexOfV_AtObj(g,b[1]);if(e!=null&&c!=null){return[e,c]}else{return[]}};X509.getHexTbsCertificateFromCert=function(b){var a=ASN1HEX.getStartPosOfV_AtObj(b,0);return a};X509.getPublicKeyHexArrayFromCertPEM=function(c){var d=ASN1HEX.pemToHex(c);var b=X509.getPublicKeyHexArrayFromCertHex(d);return b};X509.hex2dn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="30"){throw"malformed DN"}var c=new Array();var d=ASN1HEX.getPosArrayOfChildren_AtObj(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2rdn(f,d[e]))}c=c.map(function(a){return a.replace("/","\\/")});return"/"+c.join("/")};X509.hex2rdn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="31"){throw"malformed RDN"}var c=new Array();var d=ASN1HEX.getPosArrayOfChildren_AtObj(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2attrTypeValue(f,d[e]))}c=c.map(function(a){return a.replace("+","\\+")});return c.join("+")};X509.hex2attrTypeValue=function(d,h){var i=ASN1HEX;if(h===undefined){h=0}if(d.substr(h,2)!=="30"){throw"malformed attribute type and value"}var g=i.getPosArrayOfChildren_AtObj(d,h);if(g.length!==2||d.substr(g[0],2)!=="06"){"malformed attribute type and value"}var b=i.getHexOfV_AtObj(d,g[0]);var f=KJUR.asn1.ASN1Util.oidHexToInt(b);var e=KJUR.asn1.x509.OID.oid2atype(f);var a=i.getHexOfV_AtObj(d,g[1]);var c=hextorstr(a);return e+"="+c};X509.getPublicKeyFromCertHex=function(b){var a=new X509();a.readCertHex(b);return a.getPublicKey()};X509.getPublicKeyFromCertPEM=function(b){var a=new X509();a.readCertPEM(b);return a.getPublicKey()};X509.getPublicKeyInfoPropOfCertPEM=function(c){var e=ASN1HEX;var b={};var a,f,d;b.algparam=null;a=new X509();a.readCertPEM(c);f=a.getPublicKeyHex();b.keyhex=e.getVbyList(f,0,[1],"03").substr(2);b.algoid=e.getVbyList(f,0,[0,0],"06");if(b.algoid==="2a8648ce3d0201"){b.algparam=e.getVbyList(f,0,[0,1],"06")}return b};X509.getPublicKeyInfoPosOfCertHEX=function(b){var a=new X509();a.readCertHex(b);return a.getPublicKeyIdx()};X509.getV3ExtInfoListOfCertHex=function(e){var f=ASN1HEX.getIdxbyList(e,0,[0,7,0],"30");var d=ASN1HEX.getPosArrayOfChildren_AtObj(e,f);var c=d.length;var b=new Array(c);for(var a=0;a<c;a++){b[a]=X509.getV3ExtItemInfo_AtObj(e,d[a])}return b};X509.getV3ExtItemInfo_AtObj=function(g,h){var d=ASN1HEX;var f={};f.posTLV=h;var b=d.getPosArrayOfChildren_AtObj(g,h);if(b.length!=2&&b.length!=3){throw"malformed X.509v3 Ext (code:001)"}if(g.substr(b[0],2)!="06"){throw"malformed X.509v3 Ext (code:002)"}var e=d.getHexOfV_AtObj(g,b[0]);f.oid=d.hextooidstr(e);f.critical=false;if(b.length==3){f.critical=true}var c=b[b.length-1];if(g.substr(c,2)!="04"){throw"malformed X.509v3 Ext (code:003)"}f.posV=d.getStartPosOfV_AtObj(g,c);return f};X509.getHexOfTLV_V3ExtValue=function(b,a){var c=X509.getPosOfTLV_V3ExtValue(b,a);if(c==-1){return null}return ASN1HEX.getHexOfTLV_AtObj(b,c)};X509.getHexOfV_V3ExtValue=function(b,a){var c=X509.getPosOfTLV_V3ExtValue(b,a);if(c==-1){return null}return ASN1HEX.getHexOfV_AtObj(b,c)};X509.getPosOfTLV_V3ExtValue=function(f,b){var d=b;if(!b.match(/^[0-9.]+$/)){d=KJUR.asn1.x509.OID.name2oid(b)}if(d==""){return -1}var c=X509.getV3ExtInfoListOfCertHex(f);for(var a=0;a<c.length;a++){var e=c[a];if(e.oid==d){return e.posV}}return -1};X509.getExtBasicConstraints=function(d){var a=X509.getHexOfV_V3ExtValue(d,"basicConstraints");if(a===null){return null}if(a===""){return{}}if(a==="0101ff"){return{cA:true}}if(a.substr(0,8)==="0101ff02"){var c=ASN1HEX.getHexOfV_AtObj(a,6);var b=parseInt(c,16);return{cA:true,pathLen:b}}throw"unknown error"};X509.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];X509.getExtKeyUsageBin=function(d){var b=X509.getHexOfV_V3ExtValue(d,"keyUsage");if(b==""){return""}if(b.length%2!=0||b.length<=2){throw"malformed key usage value"}var a=parseInt(b.substr(0,2));var c=parseInt(b.substr(2),16).toString(2);return c.substr(0,c.length-a)};X509.getExtKeyUsageString=function(e){var d=X509.getExtKeyUsageBin(e);var b=new Array();for(var c=0;c<d.length;c++){if(d.substr(c,1)=="1"){b.push(X509.KEYUSAGE_NAME[c])}}return b.join(",")};X509.getExtSubjectKeyIdentifier=function(b){var a=X509.getHexOfV_V3ExtValue(b,"subjectKeyIdentifier");return a};X509.getExtAuthorityKeyIdentifier=function(f){var b={};var e=X509.getHexOfTLV_V3ExtValue(f,"authorityKeyIdentifier");if(e===null){return null}var c=ASN1HEX.getPosArrayOfChildren_AtObj(e,0);for(var d=0;d<c.length;d++){if(e.substr(c[d],2)==="80"){b.kid=ASN1HEX.getHexOfV_AtObj(e,c[d])}}return b};X509.getExtExtKeyUsageName=function(k){var b=new Array();var f=X509.getHexOfTLV_V3ExtValue(k,"extKeyUsage");if(f===null){return null}var c=ASN1HEX.getPosArrayOfChildren_AtObj(f,0);for(var e=0;e<c.length;e++){var j=ASN1HEX.getHexOfV_AtObj(f,c[e]);var g=KJUR.asn1.ASN1Util.oidHexToInt(j);var d=KJUR.asn1.x509.OID.oid2name(g);b.push(d)}return b};X509.getExtSubjectAltName=function(g){var b=new Array();var f=X509.getHexOfTLV_V3ExtValue(g,"subjectAltName");var c=ASN1HEX.getPosArrayOfChildren_AtObj(f,0);for(var e=0;e<c.length;e++){if(f.substr(c[e],2)==="82"){var d=hextoutf8(ASN1HEX.getHexOfV_AtObj(f,c[e]));b.push(d)}}return b};X509.getExtCRLDistributionPointsURI=function(n){var p=ASN1HEX;var q=new Array();var k=X509.getHexOfTLV_V3ExtValue(n,"cRLDistributionPoints");var o=p.getPosArrayOfChildren_AtObj(k,0);for(var g=0;g<o.length;g++){var l=p.getHexOfTLV_AtObj(k,o[g]);var b=p.getPosArrayOfChildren_AtObj(l,0);for(var e=0;e<b.length;e++){if(l.substr(b[e],2)==="a0"){var f=p.getHexOfV_AtObj(l,b[e]);if(f.substr(0,2)==="a0"){var c=p.getHexOfV_AtObj(f,0);if(c.substr(0,2)==="86"){var m=p.getHexOfV_AtObj(c,0);var d=hextoutf8(m);q.push(d)}}}}}return q};X509.getExtAIAInfo=function(g){var j={};j.ocsp=[];j.caissuer=[];var h=X509.getPosOfTLV_V3ExtValue(g,"authorityInfoAccess");if(h==-1){return null}if(g.substr(h,2)!="30"){throw"malformed AIA Extn Value"}var d=ASN1HEX.getPosArrayOfChildren_AtObj(g,h);for(var c=0;c<d.length;c++){var a=d[c];var b=ASN1HEX.getPosArrayOfChildren_AtObj(g,a);if(b.length!=2){throw"malformed AccessDescription of AIA Extn"}var e=b[0];var f=b[1];if(ASN1HEX.getHexOfV_AtObj(g,e)=="2b06010505073001"){if(g.substr(f,2)=="86"){j.ocsp.push(hextoutf8(ASN1HEX.getHexOfV_AtObj(g,f)))}}if(ASN1HEX.getHexOfV_AtObj(g,e)=="2b06010505073002"){if(g.substr(f,2)=="86"){j.caissuer.push(hextoutf8(ASN1HEX.getHexOfV_AtObj(g,f)))}}}return j};X509.getSignatureAlgorithmName=function(d){var b=ASN1HEX.getVbyList(d,0,[1,0],"06");var a=KJUR.asn1.ASN1Util.oidHexToInt(b);var c=KJUR.asn1.x509.OID.oid2name(a);return c};X509.getSignatureValueHex=function(a){return ASN1HEX.getVbyList(a,0,[2],"03",true)};X509.getSerialNumberHex=function(b){var a=new X509();a.readCertHex(b);return a.getSerialNumberHex()};X509.verifySignature=function(f,c){var d=X509.getSignatureAlgorithmName(f);var a=X509.getSignatureValueHex(f);var b=ASN1HEX.getTLVbyList(f,0,[0],"30");var e=new KJUR.crypto.Signature({alg:d});e.init(c);e.updateHex(b);return e.verify(a)};