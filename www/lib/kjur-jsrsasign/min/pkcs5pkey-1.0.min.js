/*! pkcs5pkey-1.1.0.js (c) 2013-2017 Kenji Urushima | kjur.github.com/jsrsasign/license
 */
var PKCS5PKEY=function(){var c=function(o,q,p){return j(CryptoJS.AES,o,q,p)};var d=function(o,q,p){return j(CryptoJS.TripleDES,o,q,p)};var j=function(r,w,t,p){var q=CryptoJS.enc.Hex.parse(w);var v=CryptoJS.enc.Hex.parse(t);var o=CryptoJS.enc.Hex.parse(p);var s={};s.key=v;s.iv=o;s.ciphertext=q;var u=r.decrypt(s,v,{iv:o});return CryptoJS.enc.Hex.stringify(u)};var k=function(o,q,p){return e(CryptoJS.AES,o,q,p)};var n=function(o,q,p){return e(CryptoJS.TripleDES,o,q,p)};var e=function(t,y,w,q){var s=CryptoJS.enc.Hex.parse(y);var x=CryptoJS.enc.Hex.parse(w);var p=CryptoJS.enc.Hex.parse(q);var o={};var v=t.encrypt(s,x,{iv:p});var r=CryptoJS.enc.Hex.parse(v.toString());var u=CryptoJS.enc.Base64.stringify(r);return u};var g={"AES-256-CBC":{proc:c,eproc:k,keylen:32,ivlen:16},"AES-192-CBC":{proc:c,eproc:k,keylen:24,ivlen:16},"AES-128-CBC":{proc:c,eproc:k,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:d,eproc:n,keylen:24,ivlen:8}};var b=function(o){return g[o]["proc"]};var l=function(o){var q=CryptoJS.lib.WordArray.random(o);var p=CryptoJS.enc.Hex.stringify(q);return p};var m=function(u){var v={};var p=u.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));if(p){v.cipher=p[1];v.ivsalt=p[2]}var o=u.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));if(o){v.type=o[1]}var t=-1;var w=0;if(u.indexOf("\r\n\r\n")!=-1){t=u.indexOf("\r\n\r\n");w=2}if(u.indexOf("\n\n")!=-1){t=u.indexOf("\n\n");w=1}var r=u.indexOf("-----END");if(t!=-1&&r!=-1){var q=u.substring(t+w*2,r-w);q=q.replace(/\s+/g,"");v.data=q}return v};var i=function(p,x,o){var u=o.substring(0,16);var s=CryptoJS.enc.Hex.parse(u);var q=CryptoJS.enc.Utf8.parse(x);var t=g[p]["keylen"]+g[p]["ivlen"];var w="";var v=null;for(;;){var r=CryptoJS.algo.MD5.create();if(v!=null){r.update(v)}r.update(q);r.update(s);v=r.finalize();w=w+CryptoJS.enc.Hex.stringify(v);if(w.length>=t*2){break}}var y={};y.keyhex=w.substr(0,g[p]["keylen"]*2);y.ivhex=w.substr(g[p]["keylen"]*2,g[p]["ivlen"]*2);return y};var a=function(o,u,q,v){var r=CryptoJS.enc.Base64.parse(o);var p=CryptoJS.enc.Hex.stringify(r);var t=g[u]["proc"];var s=t(p,q,v);return s};var f=function(o,r,p,t){var q=g[r]["eproc"];var s=q(o,p,t);return s};return{version:"1.0.5",getHexFromPEM:function(o,p){return ASN1HEX.pemToHex(o,p)},getDecryptedKeyHexByKeyIV:function(p,s,r,q){var o=b(s);return o(p,r,q)},parsePKCS5PEM:function(o){return m(o)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(p,o,q){return i(p,o,q)},decryptKeyB64:function(o,q,p,r){return a(o,q,p,r)},getDecryptedKeyHex:function(x,w){var p=m(x);var s=p.type;var q=p.cipher;var o=p.ivsalt;var r=p.data;var v=i(q,w,o);var u=v.keyhex;var t=a(r,q,u,o);return t},getRSAKeyFromEncryptedPKCS5PEM:function(q,p){var r=this.getDecryptedKeyHex(q,p);var o=new RSAKey();o.readPrivateKeyFromASN1HexString(r);return o},getEncryptedPKCS5PEMFromPrvKeyHex:function(r,y,s,q){if(typeof s=="undefined"||s==null){s="AES-256-CBC"}if(typeof g[s]=="undefined"){throw"PKCS5PKEY unsupported algorithm: "+s}if(typeof q=="undefined"||q==null){var u=g[s]["ivlen"];var t=l(u);q=t.toUpperCase()}var x=i(s,y,q);var w=x.keyhex;var v=f(r,s,w,q);var p=v.replace(/(.{64})/g,"$1\r\n");var o="-----BEGIN RSA PRIVATE KEY-----\r\n";o+="Proc-Type: 4,ENCRYPTED\r\n";o+="DEK-Info: "+s+","+q+"\r\n";o+="\r\n";o+=p;o+="\r\n-----END RSA PRIVATE KEY-----\r\n";return o},getEncryptedPKCS5PEMFromRSAKey:function(C,D,o,s){var A=new KJUR.asn1.DERInteger({"int":0});var v=new KJUR.asn1.DERInteger({bigint:C.n});var z=new KJUR.asn1.DERInteger({"int":C.e});var B=new KJUR.asn1.DERInteger({bigint:C.d});var t=new KJUR.asn1.DERInteger({bigint:C.p});var r=new KJUR.asn1.DERInteger({bigint:C.q});var y=new KJUR.asn1.DERInteger({bigint:C.dmp1});var u=new KJUR.asn1.DERInteger({bigint:C.dmq1});var x=new KJUR.asn1.DERInteger({bigint:C.coeff});var E=new KJUR.asn1.DERSequence({array:[A,v,z,B,t,r,y,u,x]});var w=E.getEncodedHex();return this.getEncryptedPKCS5PEMFromPrvKeyHex(w,D,o,s)},newEncryptedPKCS5PEM:function(o,p,s,t){if(typeof p=="undefined"||p==null){p=1024}if(typeof s=="undefined"||s==null){s="10001"}var q=new RSAKey();q.generate(p,s);var r=null;if(typeof t=="undefined"||t==null){r=this.getEncryptedPKCS5PEMFromRSAKey(pkey,o)}else{r=this.getEncryptedPKCS5PEMFromRSAKey(pkey,o,t)}return r},getRSAKeyFromPlainPKCS8PEM:function(q){if(q.match(/ENCRYPTED/)){throw"pem shall be not ENCRYPTED"}var p=ASN1HEX.pemToHex(q,"PRIVATE KEY");var o=this.getRSAKeyFromPlainPKCS8Hex(p);return o},getRSAKeyFromPlainPKCS8Hex:function(p){var o=new RSAKey();o.readPKCS8PrvKeyHex(p);return o},parseHexOfEncryptedPKCS8:function(v){var r={};var q=ASN1HEX.getPosArrayOfChildren_AtObj(v,0);if(q.length!=2){throw"malformed format: SEQUENCE(0).items != 2: "+q.length}r.ciphertext=ASN1HEX.getHexOfV_AtObj(v,q[1]);var x=ASN1HEX.getPosArrayOfChildren_AtObj(v,q[0]);if(x.length!=2){throw"malformed format: SEQUENCE(0.0).items != 2: "+x.length}if(ASN1HEX.getHexOfV_AtObj(v,x[0])!="2a864886f70d01050d"){throw"this only supports pkcs5PBES2"}var o=ASN1HEX.getPosArrayOfChildren_AtObj(v,x[1]);if(x.length!=2){throw"malformed format: SEQUENCE(0.0.1).items != 2: "+o.length}var p=ASN1HEX.getPosArrayOfChildren_AtObj(v,o[1]);if(p.length!=2){throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+p.length}if(ASN1HEX.getHexOfV_AtObj(v,p[0])!="2a864886f70d0307"){throw"this only supports TripleDES"}r.encryptionSchemeAlg="TripleDES";r.encryptionSchemeIV=ASN1HEX.getHexOfV_AtObj(v,p[1]);var s=ASN1HEX.getPosArrayOfChildren_AtObj(v,o[0]);if(s.length!=2){throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+s.length}if(ASN1HEX.getHexOfV_AtObj(v,s[0])!="2a864886f70d01050c"){throw"this only supports pkcs5PBKDF2"}var w=ASN1HEX.getPosArrayOfChildren_AtObj(v,s[1]);if(w.length<2){throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+w.length}r.pbkdf2Salt=ASN1HEX.getHexOfV_AtObj(v,w[0]);var t=ASN1HEX.getHexOfV_AtObj(v,w[1]);try{r.pbkdf2Iter=parseInt(t,16)}catch(u){throw"malformed format pbkdf2Iter: "+t}return r},getPBKDF2KeyHexFromParam:function(t,o){var s=CryptoJS.enc.Hex.parse(t.pbkdf2Salt);var p=t.pbkdf2Iter;var r=CryptoJS.PBKDF2(o,s,{keySize:192/32,iterations:p});var q=CryptoJS.enc.Hex.stringify(r);return q},getPlainPKCS8HexFromEncryptedPKCS8PEM:function(w,x){var q=ASN1HEX.pemToHex(w,"ENCRYPTED PRIVATE KEY");var o=this.parseHexOfEncryptedPKCS8(q);var t=PKCS5PKEY.getPBKDF2KeyHexFromParam(o,x);var u={};u.ciphertext=CryptoJS.enc.Hex.parse(o.ciphertext);var s=CryptoJS.enc.Hex.parse(t);var r=CryptoJS.enc.Hex.parse(o.encryptionSchemeIV);var v=CryptoJS.TripleDES.decrypt(u,s,{iv:r});var p=CryptoJS.enc.Hex.stringify(v);return p},getRSAKeyFromEncryptedPKCS8PEM:function(r,q){var p=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(r,q);var o=this.getRSAKeyFromPlainPKCS8Hex(p);return o},getKeyFromEncryptedPKCS8PEM:function(r,p){var o=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(r,p);var q=this.getKeyFromPlainPrivatePKCS8Hex(o);return q},parsePlainPrivatePKCS8Hex:function(r){var p={};p.algparam=null;if(r.substr(0,2)!="30"){throw"malformed plain PKCS8 private key(code:001)"}var q=ASN1HEX.getPosArrayOfChildren_AtObj(r,0);if(q.length!=3){throw"malformed plain PKCS8 private key(code:002)"}if(r.substr(q[1],2)!="30"){throw"malformed PKCS8 private key(code:003)"}var o=ASN1HEX.getPosArrayOfChildren_AtObj(r,q[1]);if(o.length!=2){throw"malformed PKCS8 private key(code:004)"}if(r.substr(o[0],2)!="06"){throw"malformed PKCS8 private key(code:005)"}p.algoid=ASN1HEX.getHexOfV_AtObj(r,o[0]);if(r.substr(o[1],2)=="06"){p.algparam=ASN1HEX.getHexOfV_AtObj(r,o[1])}if(r.substr(q[2],2)!="04"){throw"malformed PKCS8 private key(code:006)"}p.keyidx=ASN1HEX.getStartPosOfV_AtObj(r,q[2]);return p},getKeyFromPlainPrivatePKCS8PEM:function(p){var o=ASN1HEX.pemToHex(p,"PRIVATE KEY");var q=this.getKeyFromPlainPrivatePKCS8Hex(o);return q},getKeyFromPlainPrivatePKCS8Hex:function(o){var p=this.parsePlainPrivatePKCS8Hex(o);var q;if(p.algoid=="2a864886f70d010101"){q=new RSAKey()}else{if(p.algoid=="2a8648ce380401"){q=new KJUR.crypto.DSA()}else{if(p.algoid=="2a8648ce3d0201"){q=new KJUR.crypto.ECDSA()}else{throw"unsupported private key algorithm"}}}q.readPKCS8PrvKeyHex(o);return q},getRSAKeyFromPublicPKCS8PEM:function(p){var q=ASN1HEX.pemToHex(p,"PUBLIC KEY");var o=this.getRSAKeyFromPublicPKCS8Hex(q);return o},getKeyFromPublicPKCS8PEM:function(p){var q=ASN1HEX.pemToHex(p,"PUBLIC KEY");var o=this.getKeyFromPublicPKCS8Hex(q);return o},getKeyFromPublicPKCS8Hex:function(o){var p;var q=ASN1HEX.getVbyList(h,0,[0,0],"06");if(q==="2a864886f70d010101"){p=new RSAKey()}else{if(q==="2a8648ce380401"){p=new KJUR.crypto.DSA()}else{if(q==="2a8648ce3d0201"){p=new KJUR.crypto.ECDSA()}else{throw"unsupported PKCS#8 public key hex"}}}p.readPKCS8PubKeyHex(h);return p},parsePublicRawRSAKeyHex:function(q){var o={};if(q.substr(0,2)!="30"){throw"malformed RSA key(code:001)"}var p=ASN1HEX.getPosArrayOfChildren_AtObj(q,0);if(p.length!=2){throw"malformed RSA key(code:002)"}if(q.substr(p[0],2)!="02"){throw"malformed RSA key(code:003)"}o.n=ASN1HEX.getHexOfV_AtObj(q,p[0]);if(q.substr(p[1],2)!="02"){throw"malformed RSA key(code:004)"}o.e=ASN1HEX.getHexOfV_AtObj(q,p[1]);return o},parsePrivateRawRSAKeyHexAtObj:function(p,r){var q=r.keyidx;if(p.substr(q,2)!="30"){throw"malformed RSA private key(code:001)"}var o=ASN1HEX.getPosArrayOfChildren_AtObj(p,q);if(o.length!=9){throw"malformed RSA private key(code:002)"}r.key={};r.key.n=ASN1HEX.getHexOfV_AtObj(p,o[1]);r.key.e=ASN1HEX.getHexOfV_AtObj(p,o[2]);r.key.d=ASN1HEX.getHexOfV_AtObj(p,o[3]);r.key.p=ASN1HEX.getHexOfV_AtObj(p,o[4]);r.key.q=ASN1HEX.getHexOfV_AtObj(p,o[5]);r.key.dp=ASN1HEX.getHexOfV_AtObj(p,o[6]);r.key.dq=ASN1HEX.getHexOfV_AtObj(p,o[7]);r.key.co=ASN1HEX.getHexOfV_AtObj(p,o[8])},parsePrivateRawECKeyHexAtObj:function(p,r){var q=r.keyidx;if(p.substr(q,2)!="30"){throw"malformed ECC private key(code:001)"}var o=ASN1HEX.getPosArrayOfChildren_AtObj(p,q);if(o.length!=3){throw"malformed ECC private key(code:002)"}if(p.substr(o[1],2)!="04"){throw"malformed ECC private key(code:003)"}r.key=ASN1HEX.getHexOfV_AtObj(p,o[1])},parsePublicPKCS8Hex:function(r){var p={};p.algparam=null;var q=ASN1HEX.getPosArrayOfChildren_AtObj(r,0);if(q.length!=2){throw"outer DERSequence shall have 2 elements: "+q.length}var s=q[0];if(r.substr(s,2)!="30"){throw"malformed PKCS8 public key(code:001)"}var o=ASN1HEX.getPosArrayOfChildren_AtObj(r,s);if(o.length!=2){throw"malformed PKCS8 public key(code:002)"}if(r.substr(o[0],2)!="06"){throw"malformed PKCS8 public key(code:003)"}p.algoid=ASN1HEX.getHexOfV_AtObj(r,o[0]);if(r.substr(o[1],2)=="06"){p.algparam=ASN1HEX.getHexOfV_AtObj(r,o[1])}if(r.substr(q[1],2)!="03"){throw"malformed PKCS8 public key(code:004)"}p.key=ASN1HEX.getHexOfV_AtObj(r,q[1]).substr(2);return p},getRSAKeyFromPublicPKCS8Hex:function(o){var p=new RSAKey();p.readPKCS8PubKeyHex(o);return p},}}();